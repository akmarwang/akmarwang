<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>王家家庭旅遊投票</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { MapPin, Users, Trophy, Plus, X } = lucide;

        const WangFamilyTravelApp = () => {
            const [destinations, setDestinations] = useState([
                { id: 1, name: '日本京都', votes: 0, voters: [] },
                { id: 2, name: '台灣花蓮', votes: 0, voters: [] },
                { id: 3, name: '韓國首爾', votes: 0, voters: [] }
            ]);
            
            const [voterName, setVoterName] = useState('');
            const [selectedDestination, setSelectedDestination] = useState('');
            const [hasVoted, setHasVoted] = useState(false);
            const [newDestination, setNewDestination] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);

            // 從本地儲存載入資料
            useEffect(() => {
                const saved = localStorage.getItem('wangFamilyVotes');
                if (saved) {
                    try {
                        setDestinations(JSON.parse(saved));
                    } catch (e) {
                        console.log('載入資料失敗，使用預設值');
                    }
                }
            }, []);

            // 儲存資料到本地儲存
            useEffect(() => {
                localStorage.setItem('wangFamilyVotes', JSON.stringify(destinations));
            }, [destinations]);

            const handleVote = () => {
                if (!voterName.trim() || !selectedDestination) {
                    alert('請輸入姓名並選擇旅遊地點！');
                    return;
                }

                // 檢查是否已經投過票
                const alreadyVoted = destinations.some(dest => 
                    dest.voters.includes(voterName.trim())
                );

                if (alreadyVoted) {
                    alert('您已經投過票了！');
                    return;
                }

                setDestinations(prev => prev.map(dest => {
                    if (dest.id === parseInt(selectedDestination)) {
                        return {
                            ...dest,
                            votes: dest.votes + 1,
                            voters: [...dest.voters, voterName.trim()]
                        };
                    }
                    return dest;
                }));

                setHasVoted(true);
                setVoterName('');
                setSelectedDestination('');
            };

            const addDestination = () => {
                if (!newDestination.trim()) {
                    alert('請輸入地點名稱！');
                    return;
                }

                if (destinations.length >= 3) {
                    alert('最多只能有3個旅遊地點！');
                    return;
                }

                const newId = Math.max(...destinations.map(d => d.id)) + 1;
                setDestinations(prev => [...prev, {
                    id: newId,
                    name: newDestination.trim(),
                    votes: 0,
                    voters: []
                }]);

                setNewDestination('');
                setShowAddForm(false);
            };

            const removeDestination = (id) => {
                if (destinations.length <= 1) {
                    alert('至少要有一個旅遊地點！');
                    return;
                }
                setDestinations(prev => prev.filter(dest => dest.id !== id));
            };

            const resetVoting = () => {
                if (confirm('確定要重新開始投票嗎？所有投票資料都會被清除。')) {
                    setDestinations(prev => prev.map(dest => ({
                        ...dest,
                        votes: 0,
                        voters: []
                    })));
                    setHasVoted(false);
                }
            };

            const totalVotes = destinations.reduce((sum, dest) => sum + dest.votes, 0);
            const winner = destinations.reduce((prev, current) => 
                prev.votes > current.votes ? prev : current
            );

            const sortedDestinations = [...destinations].sort((a, b) => b.votes - a.votes);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
                        {/* Header */}
                        <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white">
                            <div className="flex items-center justify-center mb-2">
                                <MapPin className="w-8 h-8 mr-2" />
                                <h1 className="text-2xl font-bold">王家家庭旅遊</h1>
                            </div>
                            <p className="text-center text-blue-100">投票決定我們的下一個旅遊地點！</p>
                        </div>

                        {/* Voting Results */}
                        <div className="p-6">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-semibold text-gray-800 flex items-center">
                                    <Trophy className="w-6 h-6 mr-2 text-yellow-500" />
                                    投票結果
                                </h2>
                                <div className="flex items-center text-sm text-gray-600">
                                    <Users className="w-4 h-4 mr-1" />
                                    總票數: {totalVotes}
                                </div>
                            </div>

                            <div className="space-y-3 mb-6">
                                {sortedDestinations.map((dest, index) => (
                                    <div key={dest.id} className="relative">
                                        <div className="flex items-center justify-between p-4 bg-gray-50 rounded-lg border-2 border-gray-200 hover:border-blue-300 transition-colors">
                                            <div className="flex items-center">
                                                {index === 0 && dest.votes > 0 && (
                                                    <Trophy className="w-5 h-5 text-yellow-500 mr-2" />
                                                )}
                                                <div>
                                                    <span className="font-medium text-gray-800">{dest.name}</span>
                                                    {dest.voters.length > 0 && (
                                                        <div className="text-xs text-gray-500 mt-1">
                                                            投票者: {dest.voters.join(', ')}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            <div className="flex items-center">
                                                <span className="text-2xl font-bold text-blue-600 mr-2">{dest.votes}</span>
                                                {destinations.length > 1 && (
                                                    <button
                                                        onClick={() => removeDestination(dest.id)}
                                                        className="text-red-500 hover:text-red-700 p-1"
                                                        title="刪除地點"
                                                    >
                                                        <X className="w-4 h-4" />
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        {totalVotes > 0 && (
                                            <div className="mt-1 bg-gray-200 rounded-full h-2">
                                                <div 
                                                    className="bg-blue-500 h-2 rounded-full transition-all duration-500"
                                                    style={{ width: `${(dest.votes / totalVotes) * 100}%` }}
                                                ></div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>

                            {/* Add New Destination */}
                            {destinations.length < 3 && (
                                <div className="mb-6">
                                    {showAddForm ? (
                                        <div className="space-y-3">
                                            <input
                                                type="text"
                                                value={newDestination}
                                                onChange={(e) => setNewDestination(e.target.value)}
                                                placeholder="輸入新的旅遊地點"
                                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                            <div className="flex space-x-2">
                                                <button
                                                    onClick={addDestination}
                                                    className="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors"
                                                >
                                                    新增
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setShowAddForm(false);
                                                        setNewDestination('');
                                                    }}
                                                    className="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors"
                                                >
                                                    取消
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <button
                                            onClick={() => setShowAddForm(true)}
                                            className="w-full flex items-center justify-center p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors text-gray-600 hover:text-blue-600"
                                        >
                                            <Plus className="w-5 h-5 mr-2" />
                                            新增旅遊地點
                                        </button>
                                    )}
                                </div>
                            )}

                            {/* Winner Announcement */}
                            {totalVotes > 0 && (
                                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4 mb-6">
                                    <div className="text-center">
                                        <Trophy className="w-8 h-8 text-yellow-500 mx-auto mb-2" />
                                        <p className="text-lg font-semibold text-gray-800">
                                            目前領先: <span className="text-yellow-600">{winner.name}</span>
                                        </p>
                                        <p className="text-sm text-gray-600">{winner.votes} 票</p>
                                    </div>
                                </div>
                            )}

                            {/* Voting Form */}
                            {!hasVoted && (
                                <div className="space-y-4">
                                    <h3 className="text-lg font-semibold text-gray-800">我要投票</h3>
                                    
                                    <input
                                        type="text"
                                        value={voterName}
                                        onChange={(e) => setVoterName(e.target.value)}
                                        placeholder="請輸入您的姓名"
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />

                                    <select
                                        value={selectedDestination}
                                        onChange={(e) => setSelectedDestination(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">選擇旅遊地點</option>
                                        {destinations.map(dest => (
                                            <option key={dest.id} value={dest.id}>{dest.name}</option>
                                        ))}
                                    </select>

                                    <button
                                        onClick={handleVote}
                                        className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                                    >
                                        投票
                                    </button>
                                </div>
                            )}

                            {hasVoted && (
                                <div className="text-center">
                                    <div className="bg-green-50 border-2 border-green-200 rounded-lg p-4 mb-4">
                                        <p className="text-green-800 font-semibold">✅ 投票成功！謝謝您的參與</p>
                                    </div>
                                    <button
                                        onClick={() => setHasVoted(false)}
                                        className="text-blue-600 hover:text-blue-800 underline"
                                    >
                                        繼續為其他家人投票
                                    </button>
                                </div>
                            )}

                            {/* Reset Button */}
                            {totalVotes > 0 && (
                                <div className="mt-6 pt-4 border-t border-gray-200">
                                    <button
                                        onClick={resetVoting}
                                        className="w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors"
                                    >
                                        重新開始投票
                                    </button>
                                </div>
                            )}

                            {/* Info */}
                            <div className="mt-6 pt-4 border-t border-gray-200 text-center">
                                <p className="text-xs text-gray-500">
                                    💾 投票資料會自動保存在瀏覽器中
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<WangFamilyTravelApp />, document.getElementById('root'));
    </script>
</body>
</html>